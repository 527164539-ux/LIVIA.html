<!DOCTYPE html><html lang="zh"><head><meta charset="UTF-8"><title id="dynamicTitle">LIVIA åˆ†æå¹³å° æé€Ÿç‰ˆ 2.2</title><meta name="viewport" content="width=device-width,initial-scale=1.0"><meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://price.jup.ag https://pro-api.solscan.io https://api.bscscan.com https://api.etherscan.io; script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com; style-src 'self' 'unsafe-inline'; frame-ancestors 'none';"><meta name="description" content="LIVIA DeFi å®æ—¶åˆ†æï¼Œæ”¯æŒ BSC/ETH/Solana"><link rel="manifest" href="manifest.json"><meta name="theme-color" content="#111"><style>:root{--bg:#111;--fg:#fff;--accent:#0af;--border:#555;--dark-bg:#222}.light{--bg:#fff;--fg:#000;--accent:#007bff;--border:#ddd;--dark-bg:#f5f5f5}body{background:var(--bg);color:var(--fg);font-family:sans-serif;margin:0;padding:0;transition:all .3s}.container{padding:10px}h2,h3{margin:5px 0}table{width:100%;border-collapse:collapse;font-size:12px}th,td{border:1px solid var(--border);padding:4px;text-align:center}th{background:var(--dark-bg)}.green{color:#0f0}.red{color:#f00}.yellow{color:#ff0}.whale{background:#ff0;color:#000}#txModal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.95);display:none;overflow:auto;z-index:9999;padding:10px;justify-content:center;align-items:center;flex-direction:column}#txModal table{width:100%;font-size:12px}#closeBtn{position:absolute;top:10px;right:10px;background:#f00;color:#fff;border:none;padding:5px 10px;cursor:pointer}.chart-container{width:100%;height:150px;margin:10px 0}#exportBtn,#pdfBtn,#shareBtn,#themeBtn{margin:10px 0;padding:5px 10px;background:var(--accent);color:var(--bg);border:none;cursor:pointer;font-size:12px}#configPanel{margin:10px 0;padding:10px;background:var(--dark-bg);border-radius:5px}input,select{background:var(--bg);color:var(--fg);border:1px solid var(--border);padding:5px;margin:5px;width:150px}button{background:var(--accent);color:var(--bg);border:none;padding:5px 10px;cursor:pointer}.error{color:#f00}#loading{text-align:center;display:none;color:var(--accent)}#alertSettings{margin:10px 0}</style><script defer src="https://cdn.jsdelivr.net/npm/ethers@6.8.0/dist/ethers.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/chartjs-chart-matrix@1.0.0/dist/chartjs-chart-matrix.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/idb@7.0.2/build/umd.js"></script><script defer src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script><script defer src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/@solana/web3.js@1.95.3/lib/index.iife.min.js"></script></head><body><div class="container"><h2>LIVIA åˆ†æå¹³å° æé€Ÿç‰ˆ 2.2</h2><a href="https://your-whitepaper-url" target="_blank" aria-label="æŸ¥çœ‹ LIVIA ç™½çš®ä¹¦">ç™½çš®ä¹¦</a><button id="themeBtn" aria-label="åˆ‡æ¢ä¸»é¢˜">åˆ‡æ¢ä¸»é¢˜</button><button id="shareBtn" style="display:none" aria-label="åˆ†äº«æŠ¥å‘Š">åˆ†äº«æŠ¥å‘Š</button><button id="pdfBtn" style="display:none" aria-label="å¯¼å‡º PDF">å¯¼å‡º PDF</button><div id="configPanel"><label>é“¾: <select id="chain" aria-label="é€‰æ‹©åŒºå—é“¾"><option>BSC</option><option>ETH</option><option>Solana</option></select></label><br><label>åˆçº¦åœ°å€: <input id="tokenAddress" value="" placeholder="è¾“å…¥ä»£å¸åˆçº¦åœ°å€" aria-label="ä»£å¸åˆçº¦åœ°å€"></label><br><label>API Key: <input id="apiKey" value="" placeholder="BSCScan/Etherscan/Solscan Key" aria-label="API Key"></label><br><div id="alertSettings"><label>ä»·æ ¼é˜ˆå€¼(%): <input id="priceThreshold" value="10" type="number" aria-label="ä»·æ ¼å˜åŒ–é˜ˆå€¼"></label><label>æŒä»“é˜ˆå€¼(%): <input id="holderThreshold" value="5" type="number" aria-label="æŒä»“å˜åŒ–é˜ˆå€¼"></label></div><button onclick="initData()" aria-label="åŠ è½½æ•°æ®">åŠ è½½æ•°æ®</button><div id="errorMsg" class="error" aria-live="polite"></div><div id="loading" aria-live="polite">åŠ è½½ä¸­...</div></div><button id="exportBtn" style="display:none" aria-label="å¯¼å‡º CSV">å¯¼å‡º CSV</button><h3>å‰100æŒå¸åœ°å€</h3><table id="holderTable" role="table" aria-label="å‰100æŒå¸åœ°å€è¡¨æ ¼"><thead><tr><th>åœ°å€</th><th>æŒä»“</th><th>å æ¯”</th><th>é²¸é±¼</th><th>æ™ºèƒ½é’±åŒ…</th><th>é£é™©è¯„åˆ†</th><th>æ“ä½œ</th></tr></thead><tbody></tbody></table><div class="chart-container"><h3>ä»·æ ¼è¶‹åŠ¿ (LIVIA/SOL)</h3><canvas id="priceChart" aria-label="ä»£å¸ä»·æ ¼è¶‹åŠ¿å›¾"></canvas></div><div class="chart-container"><h3>æŒå¸å æ¯”</h3><canvas id="holderChart" aria-label="æŒå¸å æ¯”åˆ†å¸ƒå›¾"></canvas></div><div class="chart-container"><h3>è²”è²…ç›˜ / ç«¯ç›˜é£é™©</h3><canvas id="riskChart" aria-label="é£é™©æŒ‡æ•°å›¾"></canvas></div><div class="chart-container"><h3>æµåŠ¨æ€§å¥åº·</h3><canvas id="lpChart" aria-label="æµåŠ¨æ€§å¥åº·é¥¼å›¾"></canvas></div><div class="chart-container"><h3>å‰100äº¤æ˜“é¢‘ç‡çƒ­åŠ›å›¾</h3><canvas id="freqHeatmap" aria-label="äº¤æ˜“é¢‘ç‡çƒ­åŠ›å›¾"></canvas></div></div><div id="txModal" role="dialog" aria-label="äº¤æ˜“è¯¦æƒ…å¼¹çª—"><button id="closeBtn" onclick="closeModal()" aria-label="å…³é—­å¼¹çª—">å…³é—­</button><div id="txDetails"></div></div><script>'use strict';let tokenAddress,apiKey,chain='BSC',tokenDecimals=18,totalSupply=0;let priceThreshold=10,holderThreshold=5;let prevTopHolderBalance=0,prevPrice=0;let refreshTimer;const dbPromise=idb.openDB('LIVIA_DB',1,{upgrade(db){db.createObjectStore('cache')}});const CACHE_EXPIRY=3e5;const solanaWeb3=window.solanaWeb3;const CHAIN_CONFIG={BSC:{provider:'https://bsc-dataseed1.binance.org',apiBase:'https://api.bscscan.com/api',factory:'0xca143ce32fe78f1f7019d7d551a6402fc5350c73',wbnb:'0xbb4CdB9CBd36B01bD1cBaEBF2De08d9173bc095c',dexName:'Pancake',decimals:18,scan:'bscscan.com'},ETH:{provider:'https://eth.llamarpc.com',apiBase:'https://api.etherscan.io/api',factory:'0x5C69bEe701ef814a2B6a3Edd4B1652CB9cc5aA6f',wbnb:'0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2',dexName:'Uniswap',decimals:18,scan:'etherscan.io'},Solana:{rpc:'https://api.mainnet-beta.solana.com',apiBase:'https://pro-api.solscan.io/v2.0',wrappedSol:'So11111111111111111111111111111111111111112',dexName:'Jupiter',decimals:9,scan:'solscan.io'}};let provider,BSCSCAN_BASE,PANCAKE_FACTORY_ADDRESS,WBNB,DEX_NAME,scanBase;const ERC20_ABI=['function decimals() view returns (uint8)','function totalSupply() view returns (uint256)','function balanceOf(address) view returns (uint256)'];const TOKEN_PROGRAM_ID=new solanaWeb3.PublicKey('TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA');function sanitizeInput(str){return str.replace(/[<>"'&]/g,'')}async function retryFetch(url,options,retries=1){for(let i=0;i<=retries;i++){try{const controller=new AbortController();const timeoutId=setTimeout(()=>controller.abort(),5e3);const res=await fetch(url,{...options,signal:controller.signal});clearTimeout(timeoutId);if(!res.ok)throw new Error(`HTTP ${res.status}`);return await res.json()}catch(e){if(i===retries||e.name==='AbortError')throw e;await new Promise(resolve=>setTimeout(resolve,2e3))}}}function saveConfig(){localStorage.setItem('LIVIA_CONFIG',JSON.stringify({chain,tokenAddress,apiKey,priceThreshold,holderThreshold}))}function loadConfig(){const config=JSON.parse(localStorage.getItem('LIVIA_CONFIG')||'{}');document.getElementById('chain').value=config.chain||'BSC';document.getElementById('tokenAddress').value=sanitizeInput(config.tokenAddress||'');document.getElementById('apiKey').value=config.apiKey||'';document.getElementById('priceThreshold').value=config.priceThreshold||10;document.getElementById('holderThreshold').value=config.holderThreshold||5;chain=config.chain||'BSC';if(config.tokenAddress&&config.apiKey)initData()}async function getCache(key){const db=await dbPromise;const entry=await db.get('cache',key);return entry&&Date.now()-entry.timestamp<CACHE_EXPIRY?entry.data:null}async function setCache(key,data){const db=await dbPromise;await db.put('cache',{timestamp:Date.now(),data},key)}function debounce(fn,delay){let timer;return(...args)=>{clearTimeout(timer);timer=setTimeout(()=>fn(...args),delay)}}const debouncedRender=debounce(renderHolderTable,1e3);const debouncedUpdatePrice=debounce(updatePriceChart,2e3);if('Notification'in window&&Notification.permission==='default')Notification.requestPermission();function sendAlert(title,body){if(Notification.permission==='granted')new Notification(title,{body});else alert(`${title}: ${body}`)}async function initData(){chain=document.getElementById('chain').value;tokenAddress=sanitizeInput(document.getElementById('tokenAddress').value.trim());apiKey=document.getElementById('apiKey').value.trim();priceThreshold=parseInt(document.getElementById('priceThreshold').value)||10;holderThreshold=parseInt(document.getElementById('holderThreshold').value)||5;const errorDiv=document.getElementById('errorMsg');if(!tokenAddress){errorDiv.innerHTML='è¯·è¾“å…¥åˆçº¦åœ°å€';return}if(chain!=='Solana'&&!ethers.isAddress(tokenAddress)){errorDiv.innerHTML='æ— æ•ˆ EVM åœ°å€';return}if(!apiKey){errorDiv.innerHTML='è¯·è¾“å…¥ API Key';return}errorDiv.innerHTML='';saveConfig();updateChainConfig();document.getElementById('exportBtn').style.display='inline-block';document.getElementById('shareBtn').style.display='inline-block';document.getElementById('pdfBtn').style.display='inline-block';showLoading(true);try{await getTokenInfo();debouncedRender();debouncedUpdatePrice()}catch(e){errorDiv.innerHTML='åˆå§‹åŒ–å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ– API Key';console.error('Init failed:',e)}finally{showLoading(false)}}function updateChainConfig(){const config=CHAIN_CONFIG[chain];provider=chain==='Solana'?new solanaWeb3.Connection(config.rpc,'confirmed'):new ethers.JsonRpcProvider(config.provider);BSCSCAN_BASE=config.apiBase;PANCAKE_FACTORY_ADDRESS=config.factory;WBNB=config.wbnb;DEX_NAME=config.dexName;scanBase=config.scan;tokenDecimals=config.decimals;document.title=`LIVIA - ${DEX_NAME} ${tokenAddress?tokenAddress.slice(0,10)+'...':''}`}async function getTokenInfo(){try{if(chain==='Solana'){const mintPublicKey=new solanaWeb3.PublicKey(tokenAddress);const supplyInfo=await provider.getTokenSupply(mintPublicKey);totalSupply=parseFloat(supplyInfo.value.amount)/Math.pow(10,supplyInfo.value.decimals);tokenDecimals=supplyInfo.value.decimals}else{const contract=new ethers.Contract(tokenAddress,ERC20_ABI,provider);tokenDecimals=await contract.decimals();totalSupply=parseFloat(ethers.formatUnits(await contract.totalSupply(),tokenDecimals))}}catch(e){console.error('Token info failed:',e);tokenDecimals=CHAIN_CONFIG[chain].decimals;totalSupply=1e9;throw e}}async function fetchLiviaPrice(){try{if(chain==='Solana'){const data=await retryFetch(`https://price.jup.ag/v4/price?ids=${tokenAddress}&vs=${CHAIN_CONFIG.Solana.wrappedSol}`,{});return data.data[tokenAddress]?.price||0}const factoryAbi=['function getPair(address tokenA, address tokenB) external view returns (address pair)'];const factory=new ethers.Contract(PANCAKE_FACTORY_ADDRESS,factoryAbi,provider);const pairAddress=await factory.getPair(tokenAddress,WBNB);if(pairAddress===ethers.ZeroAddress)return 0;const pairAbi=['function getReserves() external view returns (uint112 reserve0, uint112 reserve1, uint32 blockTimestampLast)','function token0() view returns (address)'];const pair=new ethers.Contract(pairAddress,pairAbi,provider);const [reserve0,reserve1]=await pair.getReserves();const token0=await pair.token0();const price=token0.toLowerCase()===tokenAddress.toLowerCase()?reserve1/reserve0:reserve0/reserve1;return parseFloat(ethers.formatUnits(price,18))}catch(e){console.error('Price failed:',e);return 0}}async function fetchHolders(){const cacheKey=`holders_${tokenAddress}`;let holders=await getCache(cacheKey);if(!holders){try{let url,headers={};if(chain==='Solana'){url=`${BSCSCAN_BASE}/token/holders?token=${tokenAddress}&limit=100&offset=0`;headers={'Authorization':`Bearer ${apiKey}`}}else{url=`${BSCSCAN_BASE}?module=token&action=tokenholderlist&contractaddress=${tokenAddress}&page=1&offset=100&apikey=${apiKey}`}const data=await retryFetch(url,{headers});if(data.status!=='1'&&!data.data)throw new Error(data.message||'API error');const result=chain==='Solana'?data.data:data.result;holders=result.map(h=>({address:chain==='Solana'?h.owner:h.TokenHolderAddress,balance:parseFloat((chain==='Solana'?h.amount:ethers.formatUnits(h.TokenHolderQuantity,tokenDecimals))),rawBalance:chain==='Solana'?h.amount:h.TokenHolderQuantity})).sort((a,b)=>b.balance-a.balance);if(holders.length===0)throw new Error('No holders found');await setCache(cacheKey,holders)}catch(e){console.error('Holders failed:',e);document.getElementById('errorMsg').innerHTML='æ— æ³•è·å–æŒå¸æ•°æ®ï¼Œè¯·æ£€æŸ¥ API Key æˆ–åœ°å€';return[]}}return holders}async function getIsSmartWallets(addresses){try{if(chain==='Solana'){const pubkeys=addresses.map(addr=>new solanaWeb3.PublicKey(addr));const accounts=await provider.getMultipleAccountsInfo(pubkeys,{commitment:'confirmed'});return accounts.map(acc=>acc&&acc.owner.toBase58()===TOKEN_PROGRAM_ID.toBase58())}const codes=await Promise.all(addresses.map(addr=>provider.getCode(addr).catch(()=>'0x')));return codes.map(code=>code!=='0x')}catch(e){console.error('Smart wallets failed:',e);document.getElementById('errorMsg').innerHTML='æ— æ³•æ£€æŸ¥æ™ºèƒ½é’±åŒ…ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ';return addresses.map(()=>false)}}async function fetchTxs(address,limit=10){const cacheKey=`txs_${address}_${limit}`;let txs=await getCache(cacheKey);if(!txs){try{let url,headers={};if(chain==='Solana'){url=`${BSCSCAN_BASE}/account/token-txs?address=${address}&token=${tokenAddress}&limit=${limit}&offset=0`;headers={'Authorization':`Bearer ${apiKey}`}}else{url=`${BSCSCAN_BASE}?module=account&action=tokentx&contractaddress=${tokenAddress}&address=${address}&startblock=0&endblock=99999999&sort=desc&page=1&offset=${limit}&apikey=${apiKey}`}const data=await retryFetch(url,{headers});if(data.status!=='1'&&!data.data)return[];const result=chain==='Solana'?data.data:data.result;txs=result.map(tx=>({hash:chain==='Solana'?tx.signature:tx.hash,timeStamp:chain==='Solana'?tx.blockTime:parseInt(tx.timeStamp),value:parseFloat((chain==='Solana'?(tx.changeAmount||0):ethers.formatUnits(tx.value,tokenDecimals))),from:chain==='Solana'?tx.source:tx.from,to:chain==='Solana'?tx.destination:tx.to}));await setCache(cacheKey,txs)}catch(e){console.error('Txs failed:',e);document.getElementById('errorMsg').innerHTML='æ— æ³•è·å–äº¤æ˜“è®°å½•ï¼Œè¯·æ£€æŸ¥ API Key æˆ–åœ°å€';return[]}}return txs}async function getRecentBuySellScore(address){const txs=await fetchTxs(address,10);const buyCount=txs.filter(tx=>tx.to.toLowerCase()===address.toLowerCase()).length;return txs.length?buyCount/txs.length:0}async function calcRisk(holder,total){if(!total||holder.isSmartWallet&&holder.recentBuySellScore>0.7)return'æé«˜';if(holder.balance/total>0.2||holder.recentBuySellScore>0.5||holder.volumeScore>2)return'é«˜';if(holder.balance/total>0.1||holder.recentBuySellScore>0.3||holder.volumeScore>1)return'ä¸­';return'ä½'}async function get24hVolume(address){const txs=await fetchTxs(address,50);const oneDayAgo=Date.now()/1e3-86400;return txs.filter(tx=>tx.timeStamp>oneDayAgo).reduce((sum,tx)=>sum+Math.abs(tx.value),0)/totalSupply*100}async function fetchLPHealth(){try{if(chain==='Solana'){const data=await retryFetch(`https://api.raydium.io/v2/amm/pools?pool_id=${tokenAddress}`,{});const lpSupply=data.data?.liquidity||0;return{lp:lpSupply,total:totalSupply}}const factory=new ethers.Contract(PANCAKE_FACTORY_ADDRESS,['function getPair(address tokenA, address tokenB) external view returns (address pair)'],provider);const pairAddress=await factory.getPair(tokenAddress,WBNB);if(pairAddress===ethers.ZeroAddress)return{lp:0,total:totalSupply};const pairAbi=['function totalSupply() view returns (uint256)','function getReserves() external view returns (uint112 reserve0, uint112 reserve1, uint32 blockTimestampLast)','function token0() view returns (address)'];const pair=new ethers.Contract(pairAddress,pairAbi,provider);const lpSupply=parseFloat(ethers.formatUnits(await pair.totalSupply(),18));const [reserve0,reserve1]=await pair.getReserves();const token0=await pair.token0();const tokenReserve=token0.toLowerCase()===tokenAddress.toLowerCase()?reserve0:reserve1;const lpTokenRatio=parseFloat(ethers.formatUnits(tokenReserve,tokenDecimals))/lpSupply;return{lp:lpTokenRatio*totalSupply,total:totalSupply}}catch(e){console.error('LP failed:',e);return{lp:0,total:totalSupply}}}let holderData=[];async function renderHolderTable(){if(refreshTimer)return;refreshTimer=setTimeout(()=>{refreshTimer=null},1e4);const holders=await fetchHolders();if(holders.length===0){sendAlert('é”™è¯¯','æ— æŒå¸æ•°æ®ï¼Œè¯·æ£€æŸ¥ API Key æˆ–åœ°å€');showLoading(false);return}const addresses=holders.map(h=>h.address);const isSmarts=await getIsSmartWallets(addresses);holderData=await Promise.all(holders.map(async(h,i)=>{const score=await getRecentBuySellScore(h.address);const txs=await fetchTxs(h.address,5);const volumeScore=await get24hVolume(h.address);return{...h,isSmartWallet:isSmarts[i],recentBuySellScore:score,txFreq:txs.length,volumeScore}}));const total=holderData.reduce((a,b)=>a+b.balance,0);const topBalance=holderData[0]?.balance||0;if(prevTopHolderBalance&&Math.abs(topBalance-prevTopHolderBalance)/prevTopHolderBalance*100>holderThreshold){sendAlert('æŒä»“è­¦æŠ¥',`Top1 åœ°å€æŒä»“å˜åŒ– ${((topBalance-prevTopHolderBalance)/prevTopHolderBalance*100).toFixed(2)}%`)}prevTopHolderBalance=topBalance;const tbody=document.querySelector('#holderTable tbody');tbody.innerHTML='';holderData.forEach(h=>{const risk=calcRisk(h,total);const isWhale=h.balance/total>0.01;const tr=document.createElement('tr');tr.className=isWhale?'whale':'';tr.innerHTML=`<td><a href="https://${scanBase}/address/${h.address}" target="_blank" style="color:var(--accent)" aria-label="æŸ¥çœ‹åœ°å€è¯¦æƒ…">${h.address.slice(0,10)}...</a></td><td>${h.balance.toFixed(0)}</td><td>${((h.balance/total*100)).toFixed(2)}%</td><td>${isWhale?'ğŸ‹':''}</td><td>${h.isSmartWallet?'âœ…':'âŒ'}</td><td class="${risk==='æé«˜'?'red':risk==='é«˜'?'yellow':'green'}">${risk}</td><td><button onclick="showTx('${h.address}')" aria-label="æŸ¥çœ‹äº¤æ˜“è¯¦æƒ…">æŸ¥çœ‹</button></td>`;tbody.appendChild(tr)});updateCharts()}async function showTx(address){const txs=await fetchTxs(address,20);const div=document.getElementById('txDetails');div.innerHTML=`<h3>${address} æœ€è¿‘äº¤æ˜“</h3>`;if(txs.length===0)div.innerHTML+='<p>æš‚æ— äº¤æ˜“è®°å½•</p>';else{let html='<table><tr><th>TxHash</th><th>æ—¶é—´</th><th>æ•°é‡</th><th>æ–¹å‘</th></tr>';txs.forEach(t=>{const dir=t.from.toLowerCase()===address.toLowerCase()?'å–å‡º':'ä¹°å…¥';html+=`<tr><td><a href="https://${scanBase}/tx/${t.hash}" target="_blank" style="color:var(--accent)" aria-label="æŸ¥çœ‹äº¤æ˜“è¯¦æƒ…">${t.hash.slice(0,10)}...</a></td><td>${new Date(t.timeStamp*1e3).toLocaleString()}</td><td>${t.value.toFixed(0)}</td><td>${dir}</td></tr>`});html+='</table>';div.innerHTML+=html}document.getElementById('txModal').style.display='flex'}function closeModal(){document.getElementById('txModal').style.display='none'}function exportCSV(){const headers=['åºå·','åœ°å€','æŒä»“','å æ¯”(%)','é²¸é±¼','æ™ºèƒ½é’±åŒ…','é£é™©è¯„åˆ†'];const rows=holderData.map((h,i)=>([i+1,h.address,h.balance.toFixed(0),((h.balance/holderData.reduce((a,b)=>a+b.balance,0)*100)).toFixed(2),h.balance/holderData.reduce((a,b)=>a+b.balance,0)>0.01?'æ˜¯':'å¦',h.isSmartWallet?'æ˜¯':'å¦',calcRisk(h,holderData.reduce((a,b)=>a+b.balance,0))]));const csvContent=[headers,...rows].map(row=>row.map(cell=>`"${cell}"`).join(',')).join('\n');const blob=new Blob([new Uint8Array([0xEF,0xBB,0xBF]),csvContent],{type:'text/csv;charset=utf-8'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download='top100_holders.csv';a.click();URL.revokeObjectURL(url)}document.getElementById('exportBtn').addEventListener('click',exportCSV);document.getElementById('pdfBtn').addEventListener('click',async()=>{const{jsPDF}=window.jspdf;const pdf=new jsPDF();pdf.text(`LIVIA åˆ†ææŠ¥å‘Š - ${chain} ${tokenAddress.slice(0,10)}...`,10,10);pdf.text(`é…ç½®: é˜ˆå€¼ ${priceThreshold}% / ${holderThreshold}% | æ—¶é—´: ${new Date().toLocaleString()}`,10,20);const tableCanvas=await html2canvas(document.getElementById('holderTable'));pdf.addImage(tableCanvas.toDataURL('image/png'),'PNG',10,30,190,100);const chartIds=['priceChart','holderChart','riskChart','lpChart','freqHeatmap'];const chartCanvases=await Promise.all(chartIds.map(id=>html2canvas(document.getElementById(id))));let yPos=140;chartCanvases.forEach((canvas,i)=>{pdf.addImage(canvas.toDataURL('image/png'),'PNG',10,yPos,190,40);yPos+=50;if(yPos>280){pdf.addPage();yPos=10}});pdf.save('livia_report.pdf')});document.getElementById('shareBtn').addEventListener('click',async()=>{const params=new URLSearchParams({token:tokenAddress,chain});const url=window.location.origin+window.location.pathname+'?'+params;try{await navigator.clipboard.writeText(url);alert('åˆ†äº«é“¾æ¥å·²å¤åˆ¶ï¼')}catch{prompt('å¤åˆ¶æ­¤é“¾æ¥:',url)}});document.getElementById('themeBtn').addEventListener('click',()=>{document.body.classList.toggle('light');localStorage.setItem('theme',document.body.classList.contains('light')?'light':'dark')});if(localStorage.getItem('theme')==='light')document.body.classList.add('light');const ctxPrice=document.getElementById('priceChart').getContext('2d');const priceChart=new Chart(ctxPrice,{type:'line',data:{labels:[],datasets:[{label:`${DEX_NAME} ä»·æ ¼`,data:[],borderColor:'#f0a500',backgroundColor:'rgba(240,165,0,0.2)'}]},options:{responsive:true,maintainAspectRatio:false,animation:false,plugins:{legend:{labels:{color:'var(--fg)'}},defer:true},scales:{x:{ticks:{color:'var(--fg)'}},y:{ticks:{color:'var(--fg)'}}}}});const ctxHolder=document.getElementById('holderChart').getContext('2d');const holderChart=new Chart(ctxHolder,{type:'bar',data:{labels:[],datasets:[{label:'å æ¯”(%)',data:[],backgroundColor:[]}]},options:{responsive:true,maintainAspectRatio:false,animation:false,plugins:{legend:{labels:{color:'var(--fg)'}},defer:true},scales:{x:{ticks:{color:'var(--fg)'}},y:{ticks:{color:'var(--fg)'}}}}});const ctxRisk=document.getElementById('riskChart').getContext('2d');const riskChart=new Chart(ctxRisk,{type:'bar',data:{labels:[],datasets:[{label:'é£é™©æŒ‡æ•°',data:[],backgroundColor:[]}]},options:{responsive:true,maintainAspectRatio:false,animation:false,plugins:{legend:{labels:{color:'var(--fg)'}},defer:true},scales:{x:{ticks:{color:'var(--fg)'}},y:{ticks:{color:'var(--fg)'}}}}});const ctxLP=document.getElementById('lpChart').getContext('2d');const lpChart=new Chart(ctxLP,{type:'pie',data:{labels:['LP é”å®š','æµé€š'],datasets:[{data:[0,100],backgroundColor:['#0a0','#f00']}]},options:{responsive:true,maintainAspectRatio:false,animation:false,plugins:{legend:{labels:{color:'var(--fg)'}},defer:true}}});const ctxFreq=document.getElementById('freqHeatmap').getContext('2d');const freqChart=new Chart(ctxFreq,{type:'matrix',data:{datasets:[{label:'äº¤æ˜“é¢‘ç‡',data:[],backgroundColor:ctx=>ctx.v?`rgba(255,0,0,${ctx.v/20})`:'transparent',width:({chart})=>chart.width/100,height:15}]},options:{responsive:true,maintainAspectRatio:false,animation:false,plugins:{legend:{display:false},defer:true},scales:{x:{type:'linear',position:'bottom',ticks:{color:'var(--fg)',stepSize:1}},y:{display:false}}}});let priceHistory=[];async function updatePriceChart(){const price=await fetchLiviaPrice();const now=new Date().toLocaleTimeString();priceHistory.push({label:now,value:price});if(priceHistory.length>20)priceHistory.shift();priceChart.data.labels=priceHistory.map(p=>p.label);priceChart.data.datasets[0].data=priceHistory.map(p=>p.value);priceChart.update('none');if(prevPrice&&Math.abs(price-prevPrice)/prevPrice*100>priceThreshold){const change=((price-prevPrice)/prevPrice*100).toFixed(2);sendAlert('ä»·æ ¼è­¦æŠ¥',`${change>0?'ä¸Šæ¶¨':'ä¸‹è·Œ'} ${Math.abs(change)}%`)}prevPrice=price}async function updateCharts(){const total=holderData.reduce((a,b)=>a+b.balance,0);const labels=holderData.map(h=>h.address.slice(0,6)+'...');const percents=holderData.map(h=>(h.balance/total*100));const colors=holderData.map(h=>h.isSmartWallet?'#0ff':'#0a0');holderChart.data.labels=labels;holderChart.data.datasets[0].data=percents;holderChart.data.datasets[0].backgroundColor=colors;holderChart.update('none');const scores=holderData.map(h=>Math.floor(h.recentBuySellScore*10));const riskColors=holderData.map(h=>h.recentBuySellScore>0.7?'#f00':'#ff0');riskChart.data.labels=labels;riskChart.data.datasets[0].data=scores;riskChart.data.datasets[0].backgroundColor=riskColors;riskChart.update('none');const data=holderData.map((h,x)=>({x,y:0,v:h.txFreq}));freqChart.data.datasets[0].data=data;freqChart.update('none');const lpData=await fetchLPHealth();lpChart.data.labels=['LP é”å®š','æµé€š'];lpChart.data.datasets[0].data=[lpData.lp,lpData.total-lpData.lp];lpChart.update('none')}function showLoading(show){document.getElementById('loading').style.display=show?'block':'none'}setInterval(debouncedRender,1e4);setInterval(debouncedUpdatePrice,15e3);if('serviceWorker'in navigator){navigator.serviceWorker.register('sw.js').then(reg=>{}).catch(err=>{})}loadConfig();</script></body></html>